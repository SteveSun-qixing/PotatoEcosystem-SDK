# Chips-SDK 开发计划总览

**版本**: 1.0.0  
**创建日期**: 2026-02-01  
**状态**: 进行中

---

## 1. 项目概述

### 1.1 项目定位

Chips-SDK（薯片开发工具包）是薯片生态的第三层架构组件，为第三方开发者提供封装良好的高层 API，简化薯片应用和插件的开发。

### 1.2 架构位置

```
┌─────────────────────────────────────────────────────────┐
│       第三方应用 / 插件开发者                            │
├─────────────────────────────────────────────────────────┤
│          Chips-SDK (开发工具包) ← 本项目                │
│      提供友好的高层 API                                  │
├─────────────────────────────────────────────────────────┤
│      公共基础层 (Chips-Foundation)                      │
│    通用功能模块(媒体、文本、文件等)                      │
├─────────────────────────────────────────────────────────┤
│        薯片微内核 (Chips-Core)                          │
│      中心路由 | 模块管理 | 生命周期                      │
└─────────────────────────────────────────────────────────┘
```

### 1.3 技术栈

- **开发语言**: TypeScript 5.0+
- **构建工具**: Rollup / tsup
- **测试框架**: Vitest
- **端到端测试**: Playwright
- **代码规范**: ESLint + Prettier
- **运行环境**: Web 浏览器、Node.js 16+、Electron 20+

### 1.4 依赖关系

```json
{
  "dependencies": {
    "@chips/core": "^1.0.0",
    "@chips/foundation": "^1.0.0"
  }
}
```

---

## 2. 核心模块

### 2.1 模块列表

| 模块 | 职责 | 优先级 |
|------|------|--------|
| ChipsSDK | 统一入口，初始化管理 | P0 |
| CoreConnector | 与内核 IPC 通信 | P0 |
| FileAPI | 文件操作（加载/保存） | P0 |
| CardAPI | 卡片业务操作 | P0 |
| BoxAPI | 箱子业务操作 | P0 |
| RendererEngine | 卡片渲染 | P0 |
| PluginSystem | 插件管理 | P0 |
| ThemeManager | 主题系统 | P0 |
| ResourceManager | 资源访问 | P1 |
| EventBus | 事件订阅发布 | P0 |
| ConfigManager | 配置读写 | P0 |
| I18nManager | 国际化 | P1 |
| Logger | 日志系统 | P0 |
| ConversionAPI | 文件格式转换（HTML/PDF/图片） | P1 |

### 2.2 模块依赖图

```
ChipsSDK (主类)
├── CoreConnector (通信层)
├── Logger (日志系统)
├── ConfigManager (配置管理)
├── EventBus (事件系统)
├── I18nManager (多语言)
├── FileAPI (文件操作)
│   └── CoreConnector
├── CardAPI (卡片管理)
│   └── CoreConnector
├── BoxAPI (箱子管理)
│   └── CoreConnector
├── RendererEngine (渲染引擎)
│   ├── CoreConnector
│   ├── PluginSystem
│   └── ThemeManager
├── PluginSystem (插件系统)
│   └── CoreConnector
├── ThemeManager (主题管理)
│   └── CoreConnector
├── ResourceManager (资源管理)
│   └── CoreConnector
└── ConversionAPI (文件转换)
    └── CoreConnector (调用 Foundation file-converter)
```

---

## 3. 开发阶段

### 阶段 1：项目初始化与基础架构（Phase1）
**预计时间**: 1-2 天

- 项目结构搭建
- 构建配置（TypeScript、Rollup、ESLint、Prettier）
- 测试框架配置
- 基础类型定义
- 工具函数库

### 阶段 2：核心通信层（Phase2）
**预计时间**: 2-3 天

- CoreConnector 实现
- IPC 通信协议
- 请求/响应处理
- 错误处理机制
- 连接管理

### 阶段 3：基础支撑模块（Phase3）
**预计时间**: 2-3 天

- Logger 日志系统
- ConfigManager 配置管理
- EventBus 事件系统
- I18nManager 多语言系统

### 阶段 4：文件操作模块（Phase4）
**预计时间**: 3-4 天

- FileAPI 实现
- ZIP 文件解析
- YAML 配置解析
- 文件验证
- 缓存机制

### 阶段 5：卡片管理模块（Phase5）
**预计时间**: 2-3 天

- CardAPI 实现
- 卡片创建/读取/更新/删除
- 基础卡片管理
- 资源管理
- 标签管理

### 阶段 6：箱子管理模块（Phase6）
**预计时间**: 2-3 天

- BoxAPI 实现
- 箱子创建/读取/更新/删除
- 卡片管理（添加/移除/排序）
- 布局管理

### 阶段 7：插件系统（Phase7）
**预计时间**: 3-4 天

- PluginSystem 实现
- 插件注册/卸载
- 插件生命周期管理
- 插件类型支持（基础卡片、布局、主题）

### 阶段 8：主题系统（Phase8）
**预计时间**: 2-3 天

- ThemeManager 实现
- 主题注册/应用
- CSS 变量管理
- 主题层级覆盖

### 阶段 9：渲染引擎（Phase9）
**预计时间**: 4-5 天

- RendererEngine 实现
- 卡片渲染
- 箱子渲染
- 懒加载支持
- 虚拟滚动支持

### 阶段 10：资源管理（Phase10）
**预计时间**: 2-3 天

- ResourceManager 实现
- 资源加载
- 路径解析
- 缓存管理
- 多协议支持

### 阶段 11：ChipsSDK 主类整合（Phase11）
**预计时间**: 2-3 天

- ChipsSDK 主类实现
- 模块整合
- 快捷方法
- 初始化流程

### 阶段 12：集成测试与性能优化（Phase12）
**预计时间**: 3-4 天

- 集成测试
- 端到端测试
- 性能优化
- 内存泄漏检测

### 阶段 13：文档完善与发布准备（Phase13）
**预计时间**: 2-3 天

- API 文档完善
- 示例代码编写
- README 完善
- CHANGELOG 更新
- 发布准备

### 阶段 14：ConversionAPI 开发（Phase14）
**预计时间**: 3-4 天

- ConversionAPI 类实现
- convert 方法（单文件转换）
- convertBatch 方法（批量转换）
- 转换器注册和管理
- 进度回调机制
- 与公共基础层 file-converter 集成
- 单元测试

---

## 4. 质量要求

### 4.1 测试覆盖率

| 类型 | 目标 |
|------|------|
| 单元测试覆盖率 | ≥ 85% |
| 分支覆盖率 | ≥ 80% |
| 函数覆盖率 | ≥ 90% |
| 核心 API 覆盖率 | 100% |

### 4.2 性能要求

| 指标 | 目标值 |
|------|--------|
| SDK 初始化时间 | < 200ms |
| 首次 API 调用响应 | < 100ms |
| 文件加载（< 1MB）| < 100ms |
| 文件加载（1-10MB）| < 500ms |
| 渲染响应时间 | < 300ms |
| SDK 核心包体积 | < 500KB |

### 4.3 代码规范

- TypeScript 严格模式
- ESLint 无错误
- Prettier 格式化
- 所有公开 API 有 JSDoc 注释
- 所有错误使用标准错误码

---

## 5. 开发原则

### 5.1 中心路由原则

所有对 Foundation 的调用必须通过 CoreConnector，禁止直接导入 Foundation 模块。

```typescript
// ✅ 正确
const result = await this.coreConnector.request({
  service: 'resource',
  method: 'read',
  payload: { path: filePath }
});

// ❌ 错误
import { ZIPProcessor } from '@chips/foundation';
```

### 5.2 多语言支持

所有界面文本使用多语言 key，不允许硬编码。

```typescript
// ✅ 正确
throw new ChipsError('FILE-1001', t('error.file_not_found'));

// ❌ 错误
throw new Error('文件未找到');
```

### 5.3 配置化

所有配置项通过配置系统管理，不允许硬编码。

```typescript
// ✅ 正确
const timeout = this.config.get('timeout.default', 30000);

// ❌ 错误
const timeout = 30000;
```

---

## 6. 文件结构

```
Chips-SDK/
├── package.json
├── tsconfig.json
├── rollup.config.js
├── vitest.config.ts
├── .eslintrc.cjs
├── .prettierrc
├── README.md
├── CHANGELOG.md
├── LICENSE
├── src/
│   ├── index.ts                 # 入口文件
│   ├── sdk.ts                   # ChipsSDK 主类
│   ├── core/
│   │   ├── connector.ts         # CoreConnector
│   │   ├── errors.ts            # 错误定义
│   │   ├── types.ts             # 核心类型
│   │   └── index.ts
│   ├── api/
│   │   ├── file-api.ts          # FileAPI
│   │   ├── card-api.ts          # CardAPI
│   │   ├── box-api.ts           # BoxAPI
│   │   └── index.ts
│   ├── renderer/
│   │   ├── engine.ts            # RendererEngine
│   │   ├── instance.ts          # RenderInstance
│   │   └── index.ts
│   ├── plugin/
│   │   ├── system.ts            # PluginSystem
│   │   ├── types.ts             # 插件类型
│   │   └── index.ts
│   ├── theme/
│   │   ├── manager.ts           # ThemeManager
│   │   ├── types.ts             # 主题类型
│   │   └── index.ts
│   ├── resource/
│   │   ├── manager.ts           # ResourceManager
│   │   └── index.ts
│   ├── event/
│   │   ├── bus.ts               # EventBus
│   │   └── index.ts
│   ├── config/
│   │   ├── manager.ts           # ConfigManager
│   │   └── index.ts
│   ├── i18n/
│   │   ├── manager.ts           # I18nManager
│   │   └── index.ts
│   ├── logger/
│   │   ├── logger.ts            # Logger
│   │   └── index.ts
│   ├── utils/
│   │   ├── id.ts                # ID 生成
│   │   ├── path.ts              # 路径处理
│   │   ├── validation.ts        # 验证工具
│   │   └── index.ts
│   └── types/
│       ├── card.ts              # 卡片类型
│       ├── box.ts               # 箱子类型
│       ├── plugin.ts            # 插件类型
│       ├── theme.ts             # 主题类型
│       └── index.ts
├── tests/
│   ├── unit/
│   │   ├── core/
│   │   ├── api/
│   │   ├── renderer/
│   │   ├── plugin/
│   │   ├── theme/
│   │   └── utils/
│   └── integration/
│       ├── file-operations.test.ts
│       ├── card-management.test.ts
│       ├── box-management.test.ts
│       └── rendering.test.ts
├── examples/
│   ├── basic-usage.ts
│   ├── plugin-development.ts
│   └── theme-customization.ts
├── docs/
│   ├── api/
│   ├── guides/
│   └── tutorials/
├── 开发计划/
│   ├── 00-开发计划总览.md
│   ├── Phase1-项目初始化/
│   ├── Phase2-核心通信层/
│   ├── ...
│   └── Phase13-发布准备/
├── 技术文档/
└── 需求文档/
```

---

## 7. 里程碑

| 阶段 | 里程碑 | 验收标准 |
|------|--------|----------|
| Phase1 | 项目骨架完成 | 构建通过，测试框架可用 |
| Phase2 | 通信层完成 | 可与 Core 通信 |
| Phase3 | 基础模块完成 | 日志、配置、事件可用 |
| Phase4-6 | 核心 API 完成 | 文件、卡片、箱子操作可用 |
| Phase7-8 | 扩展系统完成 | 插件、主题系统可用 |
| Phase9-10 | 渲染系统完成 | 卡片渲染可用 |
| Phase11 | SDK 整合完成 | 主类功能完整 |
| Phase12 | 测试完成 | 覆盖率达标 |
| Phase13 | 发布就绪 | 文档完善，可发布 |
| Phase14 | 转换功能完成 | ConversionAPI 可用，支持 HTML/PDF/图片转换 |

---

## 8. 开发顺序

基于依赖关系，推荐的开发顺序：

1. **基础设施**: Logger → ConfigManager → EventBus → I18nManager
2. **通信层**: CoreConnector（错误处理）
3. **数据操作**: FileAPI → CardAPI → BoxAPI
4. **扩展系统**: PluginSystem → ThemeManager
5. **渲染系统**: ResourceManager → RendererEngine
6. **整合**: ChipsSDK 主类
7. **转换系统**: ConversionAPI
8. **质量保证**: 测试 → 文档 → 发布

---

**文档维护者**: Chips 生态核心团队
