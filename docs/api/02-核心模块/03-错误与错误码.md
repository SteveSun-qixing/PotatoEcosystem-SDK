# 错误与错误码

> 版本: 1.0.0  
> 源码: `Chips-SDK/src/core/errors.ts`, `Chips-SDK/src/core/error-codes.ts`

## 错误基类

### `ChipsError`

所有 SDK 自定义错误的基类.

- `code: string`: 错误码
- `message: string`: 错误消息
- `details?: Record<string, unknown>`: 详细信息
- `toJSON()`/`toString()` 便于序列化和日志输出

## 错误子类

| 类名 | 默认错误码 | 说明 |
| --- | --- | --- |
| `ConnectionError` | `CONN-1001` | 连接相关错误 |
| `TimeoutError` | `CONN-1002` | 超时错误 |
| `ProtocolError` | `PROTOCOL-1001` | 协议错误 |
| `RouteError` | `ROUTE-1001` | 路由错误 |
| `FileError` | 由调用方传入 | 文件相关错误 |
| `ValidationError` | `VAL-1001` | 验证错误 |
| `PluginError` | 由调用方传入 | 插件错误 |
| `RenderError` | 由调用方传入 | 渲染错误 |
| `ResourceError` | 由调用方传入 | 资源错误 |

## ErrorCodes

`ErrorCodes` 由 `CommonErrorCodes` 与 `ExportErrorCodes` 组成.

### CommonErrorCodes

- `COMMON-0001` UNKNOWN
- `COMMON-0002` INVALID_INPUT
- `COMMON-0003` INVALID_STATE
- `COMMON-0004` OPERATION_FAILED
- `COMMON-0005` NOT_IMPLEMENTED
- `VAL-1001` VALIDATION_FAILED
- `VAL-1002` INVALID_FORMAT
- `VAL-1003` REQUIRED_FIELD_MISSING
- `VAL-1004` INVALID_VALUE
- `PERM-2001` PERMISSION_DENIED
- `PERM-2002` UNAUTHORIZED
- `PERM-2003` FORBIDDEN
- `RES-3001` RESOURCE_NOT_FOUND
- `RES-3002` RESOURCE_LOCKED
- `RES-3003` RESOURCE_CONFLICT
- `RES-3004` RESOURCE_EXHAUSTED
- `NET-4001` NETWORK_ERROR
- `NET-4002` CONNECTION_FAILED
- `NET-4003` REQUEST_TIMEOUT
- `NET-4004` SERVER_ERROR
- `SYS-9001` SYSTEM_ERROR
- `SYS-9002` INTERNAL_ERROR
- `SYS-9003` NOT_SUPPORTED
- `SYS-9004` DEPRECATED

### ExportErrorCodes

覆盖导出/转换、打包、文件系统、ZIP 等场景, 例如:

- `EXPORT-0001` EXPORT_FAILED
- `EXPORT-1001` PACK_FAILED
- `EXPORT-2001` HTML_CONVERSION_FAILED
- `EXPORT-3001` PDF_CONVERSION_FAILED
- `EXPORT-4001` IMAGE_CONVERSION_FAILED
- `EXPORT-5001` FILE_WRITE_FAILED
- `EXPORT-6001` ZIP_CREATE_FAILED

详见 `Chips-SDK/src/core/error-codes.ts`.

## 重要注意事项

当前 SDK 代码中使用了多组 **尚未在 `ErrorCodes` 中定义** 的错误常量, 包括:

- SDK: `SDK_INITIALIZING`, `SDK_DESTROYED`, `SDK_NOT_INITIALIZED`
- FileAPI/BoxAPI/CardAPI: `FILE_INVALID_PATH`, `FILE_FORMAT_INVALID`, `FILE_READ_FAILED`, `FILE_CORRUPTED`, `FILE_ALREADY_EXISTS`, `FILE_WRITE_FAILED`, `FILE_NOT_FOUND`
- PluginManager: `PLUGIN_ALREADY_EXISTS`, `PLUGIN_NOT_FOUND`, `PLUGIN_LOAD_FAILED`, `PLUGIN_DEPENDENCY_MISSING`
- RendererEngine: `RENDER_FAILED`
- ResourceManager: `RES_NOT_FOUND`

如未在 `ErrorCodes` 中补充这些常量, 对应错误码将变为 `undefined`.

## 使用建议

- 捕获错误时优先判断 `instanceof ChipsError`.
- 生产环境中建议将错误码与 `details` 一并记录, 便于排查.
- 为了对齐生态规范, 建议将上述缺失的错误码补充到 `ErrorCodes` 并记录到标准文档中.
