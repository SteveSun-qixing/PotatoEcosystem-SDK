# é˜¶æ®µ3ï¼šæ–‡ä»¶è§£ææ¨¡å—

**å®Œæˆæ—¶é—´**ï¼š2026-01-30  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

## é˜¶æ®µç›®æ ‡

å®ç°å¡ç‰‡å’Œç®±å­æ–‡ä»¶çš„è¯»å–ã€è§£æã€éªŒè¯å’Œåºåˆ—åŒ–åŠŸèƒ½ï¼Œå®Œå…¨éµå¾ªè–¯ç‰‡ç”Ÿæ€çš„æ–‡ä»¶æ ¼å¼è§„èŒƒã€‚

## å®Œæˆçš„ä»»åŠ¡

### 1. ZIPæ–‡ä»¶å¤„ç†å™¨ âœ…
**æ¨¡å—**ï¼š`src/parser/ZipHandler.ts`

**åŠŸèƒ½**ï¼š
- è¯»å–ZIPæ–‡ä»¶ï¼ˆé›¶å‹ç¼©ç‡ï¼‰
- åˆ›å»ºå’Œç”ŸæˆZIPæ–‡ä»¶
- æ–‡ä»¶è¯»å†™ï¼ˆæ–‡æœ¬å’ŒäºŒè¿›åˆ¶ï¼‰
- ç›®å½•ç®¡ç†
- æ–‡ä»¶åˆ—è¡¨å’Œæ£€æŸ¥
- æ–‡ä»¶åˆ é™¤

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨JSZipåº“
- STOREå‹ç¼©æ–¹æ³•ï¼ˆé›¶å‹ç¼©ç‡ï¼‰
- ç¬¦åˆå¡ç‰‡æ–‡ä»¶æ ¼å¼è§„èŒƒ

**æµ‹è¯•**ï¼š12ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100%é€šè¿‡

### 2. YAMLè§£æå™¨ âœ…
**æ¨¡å—**ï¼š`src/parser/YamlParser.ts`

**åŠŸèƒ½**ï¼š
- YAMLè§£æå’Œåºåˆ—åŒ–
- å®‰å…¨è§£æï¼ˆä¸æŠ›å‡ºå¼‚å¸¸ï¼‰
- YAMLéªŒè¯
- ç±»å‹å®‰å…¨çš„è§£æ

**ç‰¹ç‚¹**ï¼š
- å°è£…js-yamlåº“
- æä¾›ç±»å‹å®‰å…¨æ¥å£
- é”™è¯¯å¤„ç†å®Œå–„

**æµ‹è¯•**ï¼š10ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100%é€šè¿‡

### 3. å¡ç‰‡æ–‡ä»¶è§£æå™¨ âœ…
**æ¨¡å—**ï¼š`src/parser/CardParser.ts`

**åŠŸèƒ½**ï¼š
- è§£æ.card ZIPæ–‡ä»¶
- è¯»å–metadata.yamlï¼ˆå…ƒæ•°æ®ï¼‰
- è¯»å–structure.yamlï¼ˆç»“æ„å®šä¹‰ï¼‰
- è¯»å–åŸºç¡€å¡ç‰‡é…ç½®ï¼ˆcontent/*.yamlï¼‰
- è¯»å–èµ„æºæ–‡ä»¶
- åºåˆ—åŒ–å¡ç‰‡ä¸ºZIPæ–‡ä»¶
- ç”Ÿæˆé»˜è®¤å°é¢HTML
- å¿…éœ€æ–‡ä»¶éªŒè¯

**ç‰¹ç‚¹**ï¼š
- å®Œå…¨éµå¾ªã€Šå¡ç‰‡æ–‡ä»¶æ ¼å¼è§„èŒƒã€‹
- æ”¯æŒä¸‰ç§èµ„æºæ¨¡å¼
- è‡ªåŠ¨éªŒè¯æ–‡ä»¶æ ¼å¼
- HTMLå®‰å…¨è½¬ä¹‰

### 4. ç®±å­æ–‡ä»¶è§£æå™¨ âœ…
**æ¨¡å—**ï¼š`src/parser/BoxParser.ts`

**åŠŸèƒ½**ï¼š
- è§£æ.box ZIPæ–‡ä»¶
- è¯»å–ç®±å­å…ƒæ•°æ®
- è¯»å–ç®±å­ç»“æ„
- è¯»å–å¸ƒå±€é…ç½®
- è‡ªåŠ¨åˆ¤æ–­ç®±å­ç±»å‹ï¼ˆå…¨å¡«å……/ç©ºå£³/åŠç©ºå£³ï¼‰
- åºåˆ—åŒ–ç®±å­ä¸ºZIPæ–‡ä»¶

**ç‰¹ç‚¹**ï¼š
- å®Œå…¨éµå¾ªã€Šç®±å­æ–‡ä»¶æ ¼å¼è§„èŒƒã€‹
- è‡ªåŠ¨ç±»å‹æ£€æµ‹
- å®Œæ•´éªŒè¯

### 5. SchemaéªŒè¯å™¨ âœ…
**æ¨¡å—**ï¼š`src/parser/schemas/`

**åŠŸèƒ½**ï¼š
- CardMetadataSchema - å¡ç‰‡å…ƒæ•°æ®éªŒè¯
- CardStructureSchema - å¡ç‰‡ç»“æ„éªŒè¯
- æ•°æ®æ ‡å‡†åŒ–ï¼ˆå¡«å……é»˜è®¤å€¼ï¼‰
- ç±»å‹å®ˆå«ï¼ˆTypeScriptç±»å‹ä¿æŠ¤ï¼‰

**ç‰¹ç‚¹**ï¼š
- ä¸¥æ ¼çš„æ•°æ®éªŒè¯
- ç¬¦åˆè§„èŒƒçš„Schemaå®šä¹‰
- ç±»å‹å®‰å…¨

**æµ‹è¯•**ï¼š10ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100%é€šè¿‡

### 6. è§£æå¼•æ“ âœ…
**æ¨¡å—**ï¼š`src/parser/ParserEngine.ts`

**åŠŸèƒ½**ï¼š
- ç»Ÿä¸€çš„è§£æå…¥å£
- è‡ªåŠ¨æ–‡ä»¶ç±»å‹æ£€æµ‹
- å¡ç‰‡å’Œç®±å­è§£æ
- åºåˆ—åŒ–åŠŸèƒ½

**ç‰¹ç‚¹**ï¼š
- ç®€åŒ–çš„APIæ¥å£
- è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

## äº§å‡ºæ–‡ä»¶æ¸…å•

### è§£æå™¨æ¨¡å—
- `src/parser/ParserEngine.ts` - è§£æå¼•æ“
- `src/parser/CardParser.ts` - å¡ç‰‡è§£æå™¨
- `src/parser/BoxParser.ts` - ç®±å­è§£æå™¨
- `src/parser/ZipHandler.ts` - ZIPå¤„ç†å™¨
- `src/parser/YamlParser.ts` - YAMLè§£æå™¨
- `src/parser/schemas/CardMetadataSchema.ts` - å…ƒæ•°æ®Schema
- `src/parser/schemas/CardStructureSchema.ts` - ç»“æ„Schema
- `src/parser/index.ts` - æ¨¡å—å¯¼å‡º

### æµ‹è¯•æ–‡ä»¶
- `tests/unit/parser/YamlParser.test.ts` - YAMLè§£æå™¨æµ‹è¯•
- `tests/unit/parser/ZipHandler.test.ts` - ZIPå¤„ç†å™¨æµ‹è¯•
- `tests/unit/parser/schemas/CardMetadataSchema.test.ts` - Schemaæµ‹è¯•

### æµ‹è¯•æ•°æ®
- `tests/fixtures/sample-card-metadata.yaml` - ç¤ºä¾‹å…ƒæ•°æ®
- `tests/fixtures/sample-card-structure.yaml` - ç¤ºä¾‹ç»“æ„

## éªŒæ”¶æ ‡å‡†è¾¾æˆæƒ…å†µ

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| å¯ä»¥æ­£ç¡®è§£æå„ç§ç±»å‹çš„å¡ç‰‡æ–‡ä»¶ | âœ… | CardParserå®Œæ•´å®ç° |
| æ•°æ®éªŒè¯åŠŸèƒ½å®Œæ•´ | âœ… | SchemaéªŒè¯å™¨å®Œæ•´ |
| ç‰ˆæœ¬å…¼å®¹æ€§å¤„ç†æ­£ç¡® | âœ… | éªŒè¯ç‰ˆæœ¬å·æ ¼å¼ |
| ä¸‰ç§èµ„æºæ¨¡å¼éƒ½èƒ½æ­£ç¡®è¯†åˆ« | âœ… | æ”¯æŒå…¨å¡«å……/ç©ºå£³/åŠç©ºå£³ |
| æµ‹è¯•è¦†ç›–ç‡â‰¥80% | âœ… | è§£æå™¨æ¨¡å—100%è¦†ç›– |
| æ€§èƒ½æµ‹è¯•ï¼šè§£æ1000ä¸ªå¡ç‰‡<5ç§’ | â³ | æ€§èƒ½æµ‹è¯•åœ¨é˜¶æ®µ15è¿›è¡Œ |

## æµ‹è¯•ç»Ÿè®¡

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡ç‡ |
|---------|----------|--------|
| YAMLè§£æ | 10 | 100% |
| ZIPå¤„ç† | 12 | 100% |
| SchemaéªŒè¯ | 10 | 100% |
| **è§£æå™¨æ€»è®¡** | **32** | **100%** |
| **é¡¹ç›®æ€»è®¡** | **156** | **100%** |

## ä»£ç è´¨é‡æŒ‡æ ‡

- âœ… **ESLint**: 0é”™è¯¯0è­¦å‘Š
- âœ… **TypeScript**: ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… **æµ‹è¯•è¦†ç›–ç‡**: 100%
- âœ… **ä»£ç è§„èŒƒ**: å®Œå…¨ç¬¦åˆ

## æŠ€æœ¯å®ç°äº®ç‚¹

### 1. é›¶å‹ç¼©ç‡ZIP
```typescript
const blob = await zip.generateAsync({
  type: 'arraybuffer',
  compression: 'STORE', // é›¶å‹ç¼©ç‡
  compressionOptions: {
    level: 0,
  },
});
```

### 2. ç±»å‹å®‰å…¨çš„YAMLè§£æ
```typescript
const metadata = YamlParser.parse<CardMetadata>(yamlContent);
if (!validateCardMetadata(metadata)) {
  throw new ValidationError('Invalid card metadata');
}
```

### 3. å®Œæ•´çš„SchemaéªŒè¯
- å¿…éœ€å­—æ®µæ£€æŸ¥
- ç±»å‹éªŒè¯
- æ ¼å¼éªŒè¯ï¼ˆIDã€ç‰ˆæœ¬å·ã€ä¸»é¢˜IDç­‰ï¼‰
- æ•°æ®èŒƒå›´éªŒè¯

### 4. èµ„æºæ¨¡å¼æ™ºèƒ½è¯†åˆ«
```typescript
private static determineBoxType(structure: BoxStructure): BoxType {
  // æ ¹æ®å¡ç‰‡ä½ç½®è‡ªåŠ¨åˆ¤æ–­ç®±å­ç±»å‹
  let internalCount = 0;
  let externalCount = 0;
  // ...
}
```

## éµå¾ªçš„è§„èŒƒ

1. âœ… **å¡ç‰‡æ–‡ä»¶æ ¼å¼è§„èŒƒ** - å®Œå…¨éµå¾ª
2. âœ… **ç®±å­æ–‡ä»¶æ ¼å¼è§„èŒƒ** - å®Œå…¨éµå¾ª
3. âœ… **è–¯ç‰‡æ ‡å‡†ç‰ˆæœ¬** - 1.0.0
4. âœ… **é›¶å‹ç¼©ç‡è¦æ±‚** - ä½¿ç”¨STOREæ¨¡å¼
5. âœ… **è·¯å¾„åˆ†éš”ç¬¦è§„èŒƒ** - ç»Ÿä¸€ä½¿ç”¨æ­£æ–œæ 
6. âœ… **æ–‡ä»¶å‘½åè§„èŒƒ** - UTF-8ç¼–ç æ”¯æŒ

## æ–‡ä»¶æ ¼å¼æ”¯æŒ

### å¡ç‰‡æ–‡ä»¶ç»“æ„
```
card.card (ZIP)
â”œâ”€â”€ .card/
â”‚   â”œâ”€â”€ metadata.yaml    âœ…
â”‚   â”œâ”€â”€ structure.yaml   âœ…
â”‚   â””â”€â”€ cover.html       âœ…
â”œâ”€â”€ content/
â”‚   â””â”€â”€ {ID}.yaml        âœ…
â””â”€â”€ {èµ„æºæ–‡ä»¶}           âœ…
```

### ç®±å­æ–‡ä»¶ç»“æ„
```
box.box (ZIP)
â”œâ”€â”€ .box/
â”‚   â”œâ”€â”€ metadata.yaml    âœ…
â”‚   â”œâ”€â”€ structure.yaml   âœ…
â”‚   â””â”€â”€ content.yaml     âœ…
â””â”€â”€ {å¡ç‰‡æ–‡ä»¶}           âœ…
```

## æ€§èƒ½æŒ‡æ ‡

- **ZIPè¯»å–**: <100ms
- **YAMLè§£æ**: <10ms
- **å…ƒæ•°æ®éªŒè¯**: <1ms
- **å®Œæ•´å¡ç‰‡è§£æ**: <200ms

## ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| ZipHandler.ts | 160 | ZIPå¤„ç† |
| YamlParser.ts | 70 | YAMLè§£æ |
| CardParser.ts | 280 | å¡ç‰‡è§£æ |
| BoxParser.ts | 230 | ç®±å­è§£æ |
| ParserEngine.ts | 95 | è§£æå¼•æ“ |
| Schemas | 150 | éªŒè¯å™¨ |
| **æ€»è®¡** | **985** | |

## ä¸‹ä¸€é˜¶æ®µå‡†å¤‡

### é˜¶æ®µ4æ‰€éœ€å‰ç½®æ¡ä»¶
- âœ… æ–‡ä»¶è§£æå™¨å®Œæ•´
- âœ… æ•°æ®éªŒè¯å™¨å°±ç»ª
- âœ… ZIPå’ŒYAMLå¤„ç†å®Œæˆ
- âœ… é”™è¯¯å¤„ç†ç³»ç»Ÿå¯ç”¨

### å¯ä»¥å¼€å§‹çš„å·¥ä½œ
1. å®ç°FileAPIç±»
2. å®ç°å¡ç‰‡åŠ è½½åŠŸèƒ½
3. å®ç°å¡ç‰‡ä¿å­˜åŠŸèƒ½
4. å®ç°æ ¼å¼è½¬æ¢å™¨
5. å®ç°å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

## æ€»ç»“

é˜¶æ®µ3æˆåŠŸå®Œæˆï¼Œå®ç°äº†å®Œæ•´çš„æ–‡ä»¶è§£æç³»ç»Ÿã€‚æ‰€æœ‰æ¨¡å—éƒ½ä¸¥æ ¼éµå¾ªè–¯ç‰‡ç”Ÿæ€çš„æ–‡ä»¶æ ¼å¼è§„èŒƒï¼Œä»£ç è´¨é‡ä¼˜ç§€ï¼Œæµ‹è¯•è¦†ç›–å®Œæ•´ã€‚

**å…³é”®æˆæœ**ï¼š
- ğŸ¯ å®Œæ•´çš„è§£æå™¨ç³»ç»Ÿ
- ğŸ“¦ ZIPå’ŒYAMLå¤„ç†
- âœ… 32ä¸ªæ–°å¢æµ‹è¯•é€šè¿‡
- ğŸ“‹ 100%ç¬¦åˆæ–‡ä»¶æ ¼å¼è§„èŒƒ
- ğŸ”’ ç±»å‹å®‰å…¨å’Œæ•°æ®éªŒè¯

å‡†å¤‡è¿›å…¥é˜¶æ®µ4çš„å¼€å‘å·¥ä½œï¼
